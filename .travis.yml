# This file was autogenerated and will overwrite each time you run travis_pypi_setup.py
language: python
python: 3.4
os: linux
dist: trusty
sudo: require

# Credit goes to: https://github.com/rgbkrk/libvirt-go/blob/master/.travis.yml
before_install:
  - sudo apt-get -qqy build-dep libvirt libvirt-devel
  - sudo apt-get -qqy install curl qemu-system-x86 sasl2-bin
  - sudo mkdir -p /usr/src && sudo chown $(id -u) /usr/src
  - curl -O -s https://libvirt.org/sources/libvirt-${LIBVIRT}.tar.${EXT}
  - tar -C /usr/src -xf libvirt-${LIBVIRT}.tar.${EXT}
  - pushd /usr/src/libvirt-${LIBVIRT}
  - |
        ./configure --prefix=/usr --localstatedir=/var --sysconfdir=/etc \
                    --without-polkit \
                    --without-esx --without-vbox --without-xen --without-libxl \
                    --with-qemu --with-lxc
  - make
  - sudo make install
  - popd
  - sudo libvirtd -d -l -f libvirtd.conf
  - sudo virtlogd -d || true
  - sudo chmod a+rwx /var/run/libvirt/libvirt-sock*
  - echo "pass" | sudo saslpasswd2 -p -a libvirt user

deploy:
  true:
    condition: $TOXENV == py27
    repo: dguitarbite/python-libvirt_provider
    tags: true
  distributions: sdist bdist_wheel
  password:
    secure: luyBzC6MzNem7n7sJ6c2ixZlWRBXfs/CpfAQlVEQZKyxUKqgGGxCP76gFhL6zwEgdYlWuv1JpWH8p9KUcCwFhPb6llK2JYXDBmDxSNx8FY/1k+iOY1/Nfakfy40s1sYy2KkjGW3zXwBcZWmk/MbwWc9HGmgzoZfx2+t3kIPLQsFFpbcrfQtKL+LN09wOovxCicC4qxq4EKPOAQP3X20XMHr4BapNMR/TUI56WyFMQrF/qF15Qy18ytBcTi2yvMgtAEapmz+Wl69/h5sjl0w0D9RFkKFf7JuwqC+IO6JLk991i382p3J1WEHH5z9ZKWzVBT0GbkLii1Olhu9whH4wcx3L9dszUvXlJ4QxElhuQQ/Qp6XfDzwWNcpyOiEpHDqUAhnyUj1++M4RdpxJWwKZ4/Ux2n4OXzI2IW6L9Pqxutu7aiPiBnbJjv8DSbGgKmHU3+teCadSsrrTSy7Vti243zoBGkoWa6nnVqPk2mrIn+24cz5iS8fwn/RZaPTIVS+isbcwBjy6hrv0VHbdw7dgzJ1zK044QFxdP1PYV2oJlOd+QMAyPAwZFkDMrQNu7CenaowjjNzDAOP0+niEBSBCQWxUZMaydadSOh6iy4LH90dwxgPf39NE7LWrPKEi5Fc3WzthaZy3oQ8Um/069ryTZqwN2R+foe0rik5JdyfpuaY=
  provider: pypi
  user: dguitarbite
env:
  - TOXENV=py34
  - TOXENV=py27
install: pip install -U tox
script: tox -e ${TOXENV}
